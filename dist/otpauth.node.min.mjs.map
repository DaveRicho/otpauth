{"version":3,"file":"otpauth.node.min.mjs","sources":["../src/utils/encoding/uint.js","../src/utils/global-scope.js","../src/utils/crypto/hmac-digest.js","../src/utils/pad.js","../src/utils/encoding/base32.js","../src/utils/encoding/hex.js","../src/utils/encoding/latin1.js","../src/utils/encoding/utf8.js","../src/utils/crypto/random-bytes.js","../src/secret.js","../src/utils/crypto/timing-safe-equal.js","../src/hotp.js","../src/totp.js","../src/uri.js","../src/version.js"],"sourcesContent":["/**\r\n * Converts an integer to an ArrayBuffer.\r\n * @param {number} num Integer.\r\n * @returns {ArrayBuffer} ArrayBuffer.\r\n */\r\nconst uintToBuf = (num) => {\r\n  const buf = new ArrayBuffer(8);\r\n  const arr = new Uint8Array(buf);\r\n  let acc = num;\r\n\r\n  for (let i = 7; i >= 0; i--) {\r\n    if (acc === 0) break;\r\n    arr[i] = acc & 255;\r\n    acc -= arr[i];\r\n    acc /= 256;\r\n  }\r\n\r\n  return buf;\r\n};\r\n\r\n/**\r\n * Converts an ArrayBuffer to an integer.\r\n * @param {ArrayBuffer} buf ArrayBuffer.\r\n * @returns {number} Integer.\r\n */\r\nconst uintFromBuf = (buf) => {\r\n  const arr = new Uint8Array(buf);\r\n  let num = 0;\r\n\r\n  for (let i = 0; i < arr.length; i++) {\r\n    if (arr[i] !== 0) {\r\n      num *= 256;\r\n      num += arr[i];\r\n    }\r\n  }\r\n\r\n  return num;\r\n};\r\n\r\nexport { uintToBuf, uintFromBuf };\r\n","/**\r\n * \"globalThis\" ponyfill.\r\n * @see [A horrifying globalThis polyfill in universal JavaScript](https://mathiasbynens.be/notes/globalthis)\r\n * @type {Object.<string, *>}\r\n */\r\nconst globalScope = (() => {\r\n  if (typeof globalThis === \"object\") return globalThis;\r\n  else {\r\n    Object.defineProperty(Object.prototype, \"__GLOBALTHIS__\", {\r\n      get() {\r\n        return this;\r\n      },\r\n      configurable: true,\r\n    });\r\n    try {\r\n      // @ts-ignore\r\n      // eslint-disable-next-line no-undef\r\n      if (typeof __GLOBALTHIS__ !== \"undefined\") return __GLOBALTHIS__;\r\n    } finally {\r\n      // @ts-ignore\r\n      delete Object.prototype.__GLOBALTHIS__;\r\n    }\r\n  }\r\n\r\n  // Still unable to determine \"globalThis\", fall back to a naive method.\r\n  if (typeof self !== \"undefined\") return self;\r\n  else if (typeof window !== \"undefined\") return window;\r\n  else if (typeof global !== \"undefined\") return global;\r\n\r\n  return undefined;\r\n})();\r\n\r\nexport { globalScope };\r\n","import * as crypto from \"crypto\";\r\nimport jsSHA from \"jssha\";\r\n\r\nimport { globalScope } from \"../global-scope.js\";\r\n\r\n/**\r\n * OpenSSL to jsSHA algorithms map.\r\n * @type {Object.<string, \"SHA-1\"|\"SHA-224\"|\"SHA-256\"|\"SHA-384\"|\"SHA-512\"|\"SHA3-224\"|\"SHA3-256\"|\"SHA3-384\"|\"SHA3-512\">}\r\n */\r\nconst OPENSSL_JSSHA_ALGO_MAP = {\r\n  SHA1: \"SHA-1\",\r\n  SHA224: \"SHA-224\",\r\n  SHA256: \"SHA-256\",\r\n  SHA384: \"SHA-384\",\r\n  SHA512: \"SHA-512\",\r\n  \"SHA3-224\": \"SHA3-224\",\r\n  \"SHA3-256\": \"SHA3-256\",\r\n  \"SHA3-384\": \"SHA3-384\",\r\n  \"SHA3-512\": \"SHA3-512\",\r\n};\r\n\r\n/**\r\n * Calculates an HMAC digest.\r\n * In Node.js, the command \"openssl list -digest-algorithms\" displays the available digest algorithms.\r\n * @param {string} algorithm Algorithm.\r\n * @param {ArrayBuffer} key Key.\r\n * @param {ArrayBuffer} message Message.\r\n * @returns {ArrayBuffer} Digest.\r\n */\r\nconst hmacDigest = (algorithm, key, message) => {\r\n  if (crypto?.createHmac) {\r\n    const hmac = crypto.createHmac(algorithm, globalScope.Buffer.from(key));\r\n    hmac.update(globalScope.Buffer.from(message));\r\n    return hmac.digest().buffer;\r\n  } else {\r\n    const variant = OPENSSL_JSSHA_ALGO_MAP[algorithm.toUpperCase()];\r\n    if (typeof variant === \"undefined\") {\r\n      throw new TypeError(\"Unknown hash function\");\r\n    }\r\n    const hmac = new jsSHA(variant, \"ARRAYBUFFER\");\r\n    hmac.setHMACKey(key, \"ARRAYBUFFER\");\r\n    hmac.update(message);\r\n    return hmac.getHMAC(\"ARRAYBUFFER\");\r\n  }\r\n};\r\n\r\nexport { hmacDigest };\r\n","/**\r\n * Pads a number with leading zeros.\r\n * @param {number|string} num Number.\r\n * @param {number} digits Digits.\r\n * @returns {string} Padded number.\r\n */\r\nconst pad = (num, digits) => {\r\n  let prefix = \"\";\r\n  let repeat = digits - String(num).length;\r\n  while (repeat-- > 0) prefix += \"0\";\r\n  return `${prefix}${num}`;\r\n};\r\n\r\nexport { pad };\r\n","/**\r\n * RFC 4648 base32 alphabet without pad.\r\n * @type {string}\r\n */\r\nconst ALPHABET = \"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567\";\r\n\r\n/**\r\n * Converts a base32 string to an ArrayBuffer (RFC 4648).\r\n * @see [LinusU/base32-decode](https://github.com/LinusU/base32-decode)\r\n * @param {string} str Base32 string.\r\n * @returns {ArrayBuffer} ArrayBuffer.\r\n */\r\nconst base32ToBuf = (str) => {\r\n  // Canonicalize to all upper case and remove padding if it exists.\r\n  let end = str.length;\r\n  while (str[end - 1] === \"=\") --end;\r\n  const cstr = (end < str.length ? str.substring(0, end) : str).toUpperCase();\r\n\r\n  const buf = new ArrayBuffer(((cstr.length * 5) / 8) | 0);\r\n  const arr = new Uint8Array(buf);\r\n  let bits = 0;\r\n  let value = 0;\r\n  let index = 0;\r\n\r\n  for (let i = 0; i < cstr.length; i++) {\r\n    const idx = ALPHABET.indexOf(cstr[i]);\r\n    if (idx === -1) throw new TypeError(`Invalid character found: ${cstr[i]}`);\r\n\r\n    value = (value << 5) | idx;\r\n    bits += 5;\r\n\r\n    if (bits >= 8) {\r\n      bits -= 8;\r\n      arr[index++] = value >>> bits;\r\n    }\r\n  }\r\n\r\n  return buf;\r\n};\r\n\r\n/**\r\n * Converts an ArrayBuffer to a base32 string (RFC 4648).\r\n * @see [LinusU/base32-encode](https://github.com/LinusU/base32-encode)\r\n * @param {ArrayBuffer} buf ArrayBuffer.\r\n * @returns {string} Base32 string.\r\n */\r\nconst base32FromBuf = (buf) => {\r\n  const arr = new Uint8Array(buf);\r\n  let bits = 0;\r\n  let value = 0;\r\n  let str = \"\";\r\n\r\n  for (let i = 0; i < arr.length; i++) {\r\n    value = (value << 8) | arr[i];\r\n    bits += 8;\r\n\r\n    while (bits >= 5) {\r\n      str += ALPHABET[(value >>> (bits - 5)) & 31];\r\n      bits -= 5;\r\n    }\r\n  }\r\n\r\n  if (bits > 0) {\r\n    str += ALPHABET[(value << (5 - bits)) & 31];\r\n  }\r\n\r\n  return str;\r\n};\r\n\r\nexport { base32ToBuf, base32FromBuf };\r\n","/**\r\n * Converts a hexadecimal string to an ArrayBuffer.\r\n * @param {string} str Hexadecimal string.\r\n * @returns {ArrayBuffer} ArrayBuffer.\r\n */\r\nconst hexToBuf = (str) => {\r\n  const buf = new ArrayBuffer(str.length / 2);\r\n  const arr = new Uint8Array(buf);\r\n\r\n  for (let i = 0; i < str.length; i += 2) {\r\n    arr[i / 2] = parseInt(str.substring(i, i + 2), 16);\r\n  }\r\n\r\n  return buf;\r\n};\r\n\r\n/**\r\n * Converts an ArrayBuffer to a hexadecimal string.\r\n * @param {ArrayBuffer} buf ArrayBuffer.\r\n * @returns {string} Hexadecimal string.\r\n */\r\nconst hexFromBuf = (buf) => {\r\n  const arr = new Uint8Array(buf);\r\n  let str = \"\";\r\n\r\n  for (let i = 0; i < arr.length; i++) {\r\n    const hex = arr[i].toString(16);\r\n    if (hex.length === 1) str += \"0\";\r\n    str += hex;\r\n  }\r\n\r\n  return str.toUpperCase();\r\n};\r\n\r\nexport { hexToBuf, hexFromBuf };\r\n","/**\r\n * Converts a Latin-1 string to an ArrayBuffer.\r\n * @param {string} str Latin-1 string.\r\n * @returns {ArrayBuffer} ArrayBuffer.\r\n */\r\nconst latin1ToBuf = (str) => {\r\n  const buf = new ArrayBuffer(str.length);\r\n  const arr = new Uint8Array(buf);\r\n\r\n  for (let i = 0; i < str.length; i++) {\r\n    arr[i] = str.charCodeAt(i) & 0xff;\r\n  }\r\n\r\n  return buf;\r\n};\r\n\r\n/**\r\n * Converts an ArrayBuffer to a Latin-1 string.\r\n * @param {ArrayBuffer} buf ArrayBuffer.\r\n * @returns {string} Latin-1 string.\r\n */\r\nconst latin1FromBuf = (buf) => {\r\n  const arr = new Uint8Array(buf);\r\n  let str = \"\";\r\n\r\n  for (let i = 0; i < arr.length; i++) {\r\n    str += String.fromCharCode(arr[i]);\r\n  }\r\n\r\n  return str;\r\n};\r\n\r\nexport { latin1ToBuf, latin1FromBuf };\r\n","import { globalScope } from \"../global-scope.js\";\r\n\r\n/**\r\n * TextEncoder instance.\r\n * @type {TextEncoder|null}\r\n */\r\nconst ENCODER = globalScope.TextEncoder\r\n  ? new globalScope.TextEncoder(\"utf-8\")\r\n  : null;\r\n\r\n/**\r\n * TextDecoder instance.\r\n * @type {TextDecoder|null}\r\n */\r\nconst DECODER = globalScope.TextDecoder\r\n  ? new globalScope.TextDecoder(\"utf-8\")\r\n  : null;\r\n\r\n/**\r\n * Converts an UTF-8 string to an ArrayBuffer.\r\n * @param {string} str String.\r\n * @returns {ArrayBuffer} ArrayBuffer.\r\n */\r\nconst utf8ToBuf = (str) => {\r\n  if (!ENCODER) {\r\n    throw new Error(\"Encoding API not available\");\r\n  }\r\n\r\n  return ENCODER.encode(str).buffer;\r\n};\r\n\r\n/**\r\n * Converts an ArrayBuffer to an UTF-8 string.\r\n * @param {ArrayBuffer} buf ArrayBuffer.\r\n * @returns {string} String.\r\n */\r\nconst utf8FromBuf = (buf) => {\r\n  if (!DECODER) {\r\n    throw new Error(\"Encoding API not available\");\r\n  }\r\n\r\n  return DECODER.decode(buf);\r\n};\r\n\r\nexport { utf8ToBuf, utf8FromBuf };\r\n","import * as crypto from \"crypto\";\r\n\r\nimport { globalScope } from \"../global-scope.js\";\r\n\r\n/**\r\n * Returns random bytes.\r\n * @param {number} size Size.\r\n * @returns {ArrayBuffer} Random bytes.\r\n */\r\nconst randomBytes = (size) => {\r\n  if (crypto?.randomBytes) {\r\n    return crypto.randomBytes(size).buffer;\r\n  } else {\r\n    if (!globalScope.crypto || !globalScope.crypto.getRandomValues) {\r\n      throw new Error(\"Cryptography API not available\");\r\n    }\r\n    return globalScope.crypto.getRandomValues(new Uint8Array(size)).buffer;\r\n  }\r\n};\r\n\r\nexport { randomBytes };\r\n","import { base32ToBuf, base32FromBuf } from \"./utils/encoding/base32.js\";\r\nimport { hexToBuf, hexFromBuf } from \"./utils/encoding/hex.js\";\r\nimport { latin1ToBuf, latin1FromBuf } from \"./utils/encoding/latin1.js\";\r\nimport { utf8ToBuf, utf8FromBuf } from \"./utils/encoding/utf8.js\";\r\nimport { randomBytes } from \"./utils/crypto/random-bytes.js\";\r\n\r\n/**\r\n * OTP secret key.\r\n */\r\nclass Secret {\r\n  /**\r\n   * Creates a secret key object.\r\n   * @param {Object} [config] Configuration options.\r\n   * @param {ArrayBuffer} [config.buffer=randomBytes] Secret key.\r\n   * @param {number} [config.size=20] Number of random bytes to generate, ignored if 'buffer' is provided.\r\n   */\r\n  constructor({ buffer, size = 20 } = {}) {\r\n    /**\r\n     * Secret key.\r\n     * @type {ArrayBuffer}\r\n     */\r\n    this.buffer = typeof buffer === \"undefined\" ? randomBytes(size) : buffer;\r\n  }\r\n\r\n  /**\r\n   * Converts a Latin-1 string to a Secret object.\r\n   * @param {string} str Latin-1 string.\r\n   * @returns {Secret} Secret object.\r\n   */\r\n  static fromLatin1(str) {\r\n    return new Secret({ buffer: latin1ToBuf(str) });\r\n  }\r\n\r\n  /**\r\n   * Converts an UTF-8 string to a Secret object.\r\n   * @param {string} str UTF-8 string.\r\n   * @returns {Secret} Secret object.\r\n   */\r\n  static fromUTF8(str) {\r\n    return new Secret({ buffer: utf8ToBuf(str) });\r\n  }\r\n\r\n  /**\r\n   * Converts a base32 string to a Secret object.\r\n   * @param {string} str Base32 string.\r\n   * @returns {Secret} Secret object.\r\n   */\r\n  static fromBase32(str) {\r\n    return new Secret({ buffer: base32ToBuf(str) });\r\n  }\r\n\r\n  /**\r\n   * Converts a hexadecimal string to a Secret object.\r\n   * @param {string} str Hexadecimal string.\r\n   * @returns {Secret} Secret object.\r\n   */\r\n  static fromHex(str) {\r\n    return new Secret({ buffer: hexToBuf(str) });\r\n  }\r\n\r\n  /**\r\n   * Latin-1 string representation of secret key.\r\n   * @type {string}\r\n   */\r\n  get latin1() {\r\n    Object.defineProperty(this, \"latin1\", {\r\n      enumerable: true,\r\n      value: latin1FromBuf(this.buffer),\r\n    });\r\n\r\n    return this.latin1;\r\n  }\r\n\r\n  /**\r\n   * UTF-8 string representation of secret key.\r\n   * @type {string}\r\n   */\r\n  get utf8() {\r\n    Object.defineProperty(this, \"utf8\", {\r\n      enumerable: true,\r\n      value: utf8FromBuf(this.buffer),\r\n    });\r\n\r\n    return this.utf8;\r\n  }\r\n\r\n  /**\r\n   * Base32 string representation of secret key.\r\n   * @type {string}\r\n   */\r\n  get base32() {\r\n    Object.defineProperty(this, \"base32\", {\r\n      enumerable: true,\r\n      value: base32FromBuf(this.buffer),\r\n    });\r\n\r\n    return this.base32;\r\n  }\r\n\r\n  /**\r\n   * Hexadecimal string representation of secret key.\r\n   * @type {string}\r\n   */\r\n  get hex() {\r\n    Object.defineProperty(this, \"hex\", {\r\n      enumerable: true,\r\n      value: hexFromBuf(this.buffer),\r\n    });\r\n\r\n    return this.hex;\r\n  }\r\n}\r\n\r\nexport { Secret };\r\n","import * as crypto from \"crypto\";\r\n\r\nimport { globalScope } from \"../global-scope.js\";\r\n\r\n/**\r\n * Returns true if a is equal to b, without leaking timing information that would allow an attacker to guess one of the values.\r\n * @param {string} a String a.\r\n * @param {string} b String b.\r\n * @returns {boolean} Equality result.\r\n */\r\nconst timingSafeEqual = (a, b) => {\r\n  if (crypto?.timingSafeEqual) {\r\n    return crypto.timingSafeEqual(\r\n      globalScope.Buffer.from(a),\r\n      globalScope.Buffer.from(b)\r\n    );\r\n  } else {\r\n    if (a.length !== b.length) {\r\n      throw new TypeError(\"Input strings must have the same length\");\r\n    }\r\n    let i = -1;\r\n    let out = 0;\r\n    while (++i < a.length) {\r\n      out |= a.charCodeAt(i) ^ b.charCodeAt(i);\r\n    }\r\n    return out === 0;\r\n  }\r\n};\r\n\r\nexport { timingSafeEqual };\r\n","import { uintToBuf } from \"./utils/encoding/uint.js\";\r\nimport { hmacDigest } from \"./utils/crypto/hmac-digest.js\";\r\nimport { pad } from \"./utils/pad.js\";\r\nimport { Secret } from \"./secret.js\";\r\nimport { timingSafeEqual } from \"./utils/crypto/timing-safe-equal.js\";\r\n\r\n/**\r\n * HOTP: An HMAC-based One-time Password Algorithm.\r\n * @see [RFC 4226](https://tools.ietf.org/html/rfc4226)\r\n */\r\nclass HOTP {\r\n  /**\r\n   * Default configuration.\r\n   * @type {{\r\n   *   issuer: string,\r\n   *   label: string,\r\n   *   algorithm: string,\r\n   *   digits: number,\r\n   *   counter: number\r\n   *   window: number\r\n   * }}\r\n   */\r\n  static get defaults() {\r\n    return {\r\n      issuer: \"\",\r\n      label: \"OTPAuth\",\r\n      algorithm: \"SHA1\",\r\n      digits: 6,\r\n      counter: 0,\r\n      window: 1,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Creates an HOTP object.\r\n   * @param {Object} [config] Configuration options.\r\n   * @param {string} [config.issuer=''] Account provider.\r\n   * @param {string} [config.label='OTPAuth'] Account label.\r\n   * @param {Secret|string} [config.secret=Secret] Secret key.\r\n   * @param {string} [config.algorithm='SHA1'] HMAC hashing algorithm.\r\n   * @param {number} [config.digits=6] Token length.\r\n   * @param {number} [config.counter=0] Initial counter value.\r\n   */\r\n  constructor({\r\n    issuer = HOTP.defaults.issuer,\r\n    label = HOTP.defaults.label,\r\n    secret = new Secret(),\r\n    algorithm = HOTP.defaults.algorithm,\r\n    digits = HOTP.defaults.digits,\r\n    counter = HOTP.defaults.counter,\r\n  } = {}) {\r\n    /**\r\n     * Account provider.\r\n     * @type {string}\r\n     */\r\n    this.issuer = issuer;\r\n    /**\r\n     * Account label.\r\n     * @type {string}\r\n     */\r\n    this.label = label;\r\n    /**\r\n     * Secret key.\r\n     * @type {Secret}\r\n     */\r\n    this.secret =\r\n      typeof secret === \"string\" ? Secret.fromBase32(secret) : secret;\r\n    /**\r\n     * HMAC hashing algorithm.\r\n     * @type {string}\r\n     */\r\n    this.algorithm = algorithm.toUpperCase();\r\n    /**\r\n     * Token length.\r\n     * @type {number}\r\n     */\r\n    this.digits = digits;\r\n    /**\r\n     * Initial counter value.\r\n     * @type {number}\r\n     */\r\n    this.counter = counter;\r\n  }\r\n\r\n  /**\r\n   * Generates an HOTP token.\r\n   * @param {Object} config Configuration options.\r\n   * @param {Secret} config.secret Secret key.\r\n   * @param {string} [config.algorithm='SHA1'] HMAC hashing algorithm.\r\n   * @param {number} [config.digits=6] Token length.\r\n   * @param {number} [config.counter=0] Counter value.\r\n   * @returns {string} Token.\r\n   */\r\n  static generate({\r\n    secret,\r\n    algorithm = HOTP.defaults.algorithm,\r\n    digits = HOTP.defaults.digits,\r\n    counter = HOTP.defaults.counter,\r\n  }) {\r\n    const digest = new Uint8Array(\r\n      hmacDigest(algorithm, secret.buffer, uintToBuf(counter))\r\n    );\r\n    const offset = digest[digest.byteLength - 1] & 15;\r\n    const otp =\r\n      (((digest[offset] & 127) << 24) |\r\n        ((digest[offset + 1] & 255) << 16) |\r\n        ((digest[offset + 2] & 255) << 8) |\r\n        (digest[offset + 3] & 255)) %\r\n      10 ** digits;\r\n\r\n    return pad(otp, digits);\r\n  }\r\n\r\n  /**\r\n   * Generates an HOTP token.\r\n   * @param {Object} [config] Configuration options.\r\n   * @param {number} [config.counter=this.counter++] Counter value.\r\n   * @returns {string} Token.\r\n   */\r\n  generate({ counter = this.counter++ } = {}) {\r\n    return HOTP.generate({\r\n      secret: this.secret,\r\n      algorithm: this.algorithm,\r\n      digits: this.digits,\r\n      counter,\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Validates an HOTP token.\r\n   * @param {Object} config Configuration options.\r\n   * @param {string} config.token Token value.\r\n   * @param {Secret} config.secret Secret key.\r\n   * @param {string} [config.algorithm='SHA1'] HMAC hashing algorithm.\r\n   * @param {number} config.digits Token length.\r\n   * @param {number} [config.counter=0] Counter value.\r\n   * @param {number} [config.window=1] Window of counter values to test.\r\n   * @returns {number|null} Token delta or null if it is not found in the search window, in which case it should be considered invalid.\r\n   */\r\n  static validate({\r\n    token,\r\n    secret,\r\n    algorithm,\r\n    digits,\r\n    counter = HOTP.defaults.counter,\r\n    window = HOTP.defaults.window,\r\n  }) {\r\n    // Return early if the token length does not match the digit number.\r\n    if (token.length !== digits) return null;\r\n\r\n    let delta = null;\r\n\r\n    for (let i = counter - window; i <= counter + window; ++i) {\r\n      const generatedToken = HOTP.generate({\r\n        secret,\r\n        algorithm,\r\n        digits,\r\n        counter: i,\r\n      });\r\n\r\n      if (timingSafeEqual(token, generatedToken)) {\r\n        delta = i - counter;\r\n      }\r\n    }\r\n\r\n    return delta;\r\n  }\r\n\r\n  /**\r\n   * Validates an HOTP token.\r\n   * @param {Object} config Configuration options.\r\n   * @param {string} config.token Token value.\r\n   * @param {number} [config.counter=this.counter] Counter value.\r\n   * @param {number} [config.window=1] Window of counter values to test.\r\n   * @returns {number|null} Token delta or null if it is not found in the search window, in which case it should be considered invalid.\r\n   */\r\n  validate({ token, counter = this.counter, window }) {\r\n    return HOTP.validate({\r\n      token,\r\n      secret: this.secret,\r\n      algorithm: this.algorithm,\r\n      digits: this.digits,\r\n      counter,\r\n      window,\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Returns a Google Authenticator key URI.\r\n   * @returns {string} URI.\r\n   */\r\n  toString() {\r\n    const e = encodeURIComponent;\r\n    return (\r\n      \"otpauth://hotp/\" +\r\n      `${\r\n        this.issuer.length > 0\r\n          ? `${e(this.issuer)}:${e(this.label)}?issuer=${e(this.issuer)}&`\r\n          : `${e(this.label)}?`\r\n      }` +\r\n      `secret=${e(this.secret.base32)}&` +\r\n      `algorithm=${e(this.algorithm)}&` +\r\n      `digits=${e(this.digits)}&` +\r\n      `counter=${e(this.counter)}`\r\n    );\r\n  }\r\n}\r\n\r\nexport { HOTP };\r\n","import { HOTP } from \"./hotp.js\";\r\nimport { Secret } from \"./secret.js\";\r\n\r\n/**\r\n * TOTP: Time-Based One-Time Password Algorithm.\r\n * @see [RFC 6238](https://tools.ietf.org/html/rfc6238)\r\n */\r\nclass TOTP {\r\n  /**\r\n   * Default configuration.\r\n   * @type {{\r\n   *   issuer: string,\r\n   *   label: string,\r\n   *   algorithm: string,\r\n   *   digits: number,\r\n   *   period: number\r\n   *   window: number\r\n   * }}\r\n   */\r\n  static get defaults() {\r\n    return {\r\n      issuer: \"\",\r\n      label: \"OTPAuth\",\r\n      algorithm: \"SHA1\",\r\n      digits: 6,\r\n      period: 30,\r\n      window: 1,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Creates a TOTP object.\r\n   * @param {Object} [config] Configuration options.\r\n   * @param {string} [config.issuer=''] Account provider.\r\n   * @param {string} [config.label='OTPAuth'] Account label.\r\n   * @param {Secret|string} [config.secret=Secret] Secret key.\r\n   * @param {string} [config.algorithm='SHA1'] HMAC hashing algorithm.\r\n   * @param {number} [config.digits=6] Token length.\r\n   * @param {number} [config.period=30] Token time-step duration.\r\n   */\r\n  constructor({\r\n    issuer = TOTP.defaults.issuer,\r\n    label = TOTP.defaults.label,\r\n    secret = new Secret(),\r\n    algorithm = TOTP.defaults.algorithm,\r\n    digits = TOTP.defaults.digits,\r\n    period = TOTP.defaults.period,\r\n  } = {}) {\r\n    /**\r\n     * Account provider.\r\n     * @type {string}\r\n     */\r\n    this.issuer = issuer;\r\n    /**\r\n     * Account label.\r\n     * @type {string}\r\n     */\r\n    this.label = label;\r\n    /**\r\n     * Secret key.\r\n     * @type {Secret}\r\n     */\r\n    this.secret =\r\n      typeof secret === \"string\" ? Secret.fromBase32(secret) : secret;\r\n    /**\r\n     * HMAC hashing algorithm.\r\n     * @type {string}\r\n     */\r\n    this.algorithm = algorithm.toUpperCase();\r\n    /**\r\n     * Token length.\r\n     * @type {number}\r\n     */\r\n    this.digits = digits;\r\n    /**\r\n     * Token time-step duration.\r\n     * @type {number}\r\n     */\r\n    this.period = period;\r\n  }\r\n\r\n  /**\r\n   * Generates a TOTP token.\r\n   * @param {Object} config Configuration options.\r\n   * @param {Secret} config.secret Secret key.\r\n   * @param {string} [config.algorithm='SHA1'] HMAC hashing algorithm.\r\n   * @param {number} [config.digits=6] Token length.\r\n   * @param {number} [config.period=30] Token time-step duration.\r\n   * @param {number} [config.timestamp=Date.now] Timestamp value in milliseconds.\r\n   * @returns {string} Token.\r\n   */\r\n  static generate({\r\n    secret,\r\n    algorithm,\r\n    digits,\r\n    period = TOTP.defaults.period,\r\n    timestamp = Date.now(),\r\n  }) {\r\n    return HOTP.generate({\r\n      secret,\r\n      algorithm,\r\n      digits,\r\n      counter: Math.floor(timestamp / 1000 / period),\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Generates a TOTP token.\r\n   * @param {Object} [config] Configuration options.\r\n   * @param {number} [config.timestamp=Date.now] Timestamp value in milliseconds.\r\n   * @returns {string} Token.\r\n   */\r\n  generate({ timestamp = Date.now() } = {}) {\r\n    return TOTP.generate({\r\n      secret: this.secret,\r\n      algorithm: this.algorithm,\r\n      digits: this.digits,\r\n      period: this.period,\r\n      timestamp,\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Validates a TOTP token.\r\n   * @param {Object} config Configuration options.\r\n   * @param {string} config.token Token value.\r\n   * @param {Secret} config.secret Secret key.\r\n   * @param {string} [config.algorithm='SHA1'] HMAC hashing algorithm.\r\n   * @param {number} config.digits Token length.\r\n   * @param {number} [config.period=30] Token time-step duration.\r\n   * @param {number} [config.timestamp=Date.now] Timestamp value in milliseconds.\r\n   * @param {number} [config.window=1] Window of counter values to test.\r\n   * @returns {number|null} Token delta or null if it is not found in the search window, in which case it should be considered invalid.\r\n   */\r\n  static validate({\r\n    token,\r\n    secret,\r\n    algorithm,\r\n    digits,\r\n    period = TOTP.defaults.period,\r\n    timestamp = Date.now(),\r\n    window,\r\n  }) {\r\n    return HOTP.validate({\r\n      token,\r\n      secret,\r\n      algorithm,\r\n      digits,\r\n      counter: Math.floor(timestamp / 1000 / period),\r\n      window,\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Validates a TOTP token.\r\n   * @param {Object} config Configuration options.\r\n   * @param {string} config.token Token value.\r\n   * @param {number} [config.timestamp=Date.now] Timestamp value in milliseconds.\r\n   * @param {number} [config.window=1] Window of counter values to test.\r\n   * @returns {number|null} Token delta or null if it is not found in the search window, in which case it should be considered invalid.\r\n   */\r\n  validate({ token, timestamp, window }) {\r\n    return TOTP.validate({\r\n      token,\r\n      secret: this.secret,\r\n      algorithm: this.algorithm,\r\n      digits: this.digits,\r\n      period: this.period,\r\n      timestamp,\r\n      window,\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Returns a Google Authenticator key URI.\r\n   * @returns {string} URI.\r\n   */\r\n  toString() {\r\n    const e = encodeURIComponent;\r\n    return (\r\n      \"otpauth://totp/\" +\r\n      `${\r\n        this.issuer.length > 0\r\n          ? `${e(this.issuer)}:${e(this.label)}?issuer=${e(this.issuer)}&`\r\n          : `${e(this.label)}?`\r\n      }` +\r\n      `secret=${e(this.secret.base32)}&` +\r\n      `algorithm=${e(this.algorithm)}&` +\r\n      `digits=${e(this.digits)}&` +\r\n      `period=${e(this.period)}`\r\n    );\r\n  }\r\n}\r\n\r\nexport { TOTP };\r\n","import { HOTP } from \"./hotp.js\";\r\nimport { TOTP } from \"./totp.js\";\r\n\r\n/**\r\n * Key URI regex (otpauth://TYPE/[ISSUER:]LABEL?PARAMETERS).\r\n * @type {RegExp}\r\n */\r\nconst OTPURI_REGEX =\r\n  /^otpauth:\\/\\/([ht]otp)\\/(.+)\\?([A-Z0-9.~_-]+=[^?&]*(?:&[A-Z0-9.~_-]+=[^?&]*)*)$/i;\r\n\r\n/**\r\n * RFC 4648 base32 alphabet with pad.\r\n * @type {RegExp}\r\n */\r\nconst SECRET_REGEX = /^[2-7A-Z]+=*$/i;\r\n\r\n/**\r\n * Regex for supported algorithms.\r\n * @type {RegExp}\r\n */\r\nconst ALGORITHM_REGEX = /^SHA(?:1|224|256|384|512|3-224|3-256|3-384|3-512)$/i;\r\n\r\n/**\r\n * Integer regex.\r\n * @type {RegExp}\r\n */\r\nconst INTEGER_REGEX = /^[+-]?\\d+$/;\r\n\r\n/**\r\n * Positive integer regex.\r\n * @type {RegExp}\r\n */\r\nconst POSITIVE_INTEGER_REGEX = /^\\+?[1-9]\\d*$/;\r\n\r\n/**\r\n * HOTP/TOTP object/string conversion.\r\n * @see [Key URI Format](https://github.com/google/google-authenticator/wiki/Key-Uri-Format)\r\n */\r\nclass URI {\r\n  /**\r\n   * Parses a Google Authenticator key URI and returns an HOTP/TOTP object.\r\n   * @param {string} uri Google Authenticator Key URI.\r\n   * @returns {HOTP|TOTP} HOTP/TOTP object.\r\n   */\r\n  static parse(uri) {\r\n    let uriGroups;\r\n\r\n    try {\r\n      uriGroups = uri.match(OTPURI_REGEX);\r\n    } catch (error) {\r\n      /* Handled below */\r\n    }\r\n\r\n    if (!Array.isArray(uriGroups)) {\r\n      throw new URIError(\"Invalid URI format\");\r\n    }\r\n\r\n    // Extract URI groups.\r\n    const uriType = uriGroups[1].toLowerCase();\r\n    const uriLabel = uriGroups[2]\r\n      .split(/(?::|%3A) *(.+)/i, 2)\r\n      .map(decodeURIComponent);\r\n    /** @type {Object.<string, string>} */\r\n    const uriParams = uriGroups[3].split(\"&\").reduce((acc, cur) => {\r\n      const pairArr = cur.split(/=(.*)/, 2).map(decodeURIComponent);\r\n      const pairKey = pairArr[0].toLowerCase();\r\n      const pairVal = pairArr[1];\r\n      /** @type {Object.<string, string>} */\r\n      const pairAcc = acc;\r\n\r\n      pairAcc[pairKey] = pairVal;\r\n      return pairAcc;\r\n    }, {});\r\n\r\n    // 'OTP' will be instantiated with 'config' argument.\r\n    let OTP;\r\n    const config = {};\r\n\r\n    if (uriType === \"hotp\") {\r\n      OTP = HOTP;\r\n\r\n      // Counter: required\r\n      if (\r\n        typeof uriParams.counter !== \"undefined\" &&\r\n        INTEGER_REGEX.test(uriParams.counter)\r\n      ) {\r\n        config.counter = parseInt(uriParams.counter, 10);\r\n      } else {\r\n        throw new TypeError(\"Missing or invalid 'counter' parameter\");\r\n      }\r\n    } else if (uriType === \"totp\") {\r\n      OTP = TOTP;\r\n\r\n      // Period: optional\r\n      if (typeof uriParams.period !== \"undefined\") {\r\n        if (POSITIVE_INTEGER_REGEX.test(uriParams.period)) {\r\n          config.period = parseInt(uriParams.period, 10);\r\n        } else {\r\n          throw new TypeError(\"Invalid 'period' parameter\");\r\n        }\r\n      }\r\n    } else {\r\n      throw new TypeError(\"Unknown OTP type\");\r\n    }\r\n\r\n    // Label: required\r\n    // Issuer: optional\r\n    if (uriLabel.length === 2) {\r\n      config.label = uriLabel[1];\r\n      config.issuer = uriLabel[0];\r\n    } else {\r\n      config.label = uriLabel[0];\r\n      if (typeof uriParams.issuer !== \"undefined\") {\r\n        config.issuer = uriParams.issuer;\r\n      }\r\n    }\r\n\r\n    // Secret: required\r\n    if (\r\n      typeof uriParams.secret !== \"undefined\" &&\r\n      SECRET_REGEX.test(uriParams.secret)\r\n    ) {\r\n      config.secret = uriParams.secret;\r\n    } else {\r\n      throw new TypeError(\"Missing or invalid 'secret' parameter\");\r\n    }\r\n\r\n    // Algorithm: optional\r\n    if (typeof uriParams.algorithm !== \"undefined\") {\r\n      if (ALGORITHM_REGEX.test(uriParams.algorithm)) {\r\n        config.algorithm = uriParams.algorithm;\r\n      } else {\r\n        throw new TypeError(\"Invalid 'algorithm' parameter\");\r\n      }\r\n    }\r\n\r\n    // Digits: optional\r\n    if (typeof uriParams.digits !== \"undefined\") {\r\n      if (POSITIVE_INTEGER_REGEX.test(uriParams.digits)) {\r\n        config.digits = parseInt(uriParams.digits, 10);\r\n      } else {\r\n        throw new TypeError(\"Invalid 'digits' parameter\");\r\n      }\r\n    }\r\n\r\n    return new OTP(config);\r\n  }\r\n\r\n  /**\r\n   * Converts an HOTP/TOTP object to a Google Authenticator key URI.\r\n   * @param {HOTP|TOTP} otp HOTP/TOTP object.\r\n   * @returns {string} Google Authenticator Key URI.\r\n   */\r\n  static stringify(otp) {\r\n    if (otp instanceof HOTP || otp instanceof TOTP) {\r\n      return otp.toString();\r\n    }\r\n\r\n    throw new TypeError(\"Invalid 'HOTP/TOTP' object\");\r\n  }\r\n}\r\n\r\nexport { URI };\r\n","/**\r\n * Library version.\r\n * @type {string}\r\n */\r\nconst version = \"__OTPAUTH_VERSION__\";\r\n\r\nexport { version };\r\n"],"names":["uintToBuf","num","buf","ArrayBuffer","arr","Uint8Array","acc","i","globalScope","globalThis","Object","defineProperty","prototype","get","configurable","__GLOBALTHIS__","self","window","global","OPENSSL_JSSHA_ALGO_MAP","SHA1","SHA224","SHA256","SHA384","SHA512","hmacDigest","algorithm","key","message","crypto","createHmac","hmac","Buffer","from","update","digest","buffer","variant","toUpperCase","TypeError","jsSHA","setHMACKey","getHMAC","pad","digits","prefix","repeat","String","length","ALPHABET","base32ToBuf","str","end","cstr","substring","bits","value","index","idx","indexOf","base32FromBuf","hexToBuf","parseInt","hexFromBuf","hex","toString","latin1ToBuf","charCodeAt","latin1FromBuf","fromCharCode","ENCODER","TextEncoder","DECODER","TextDecoder","utf8ToBuf","Error","encode","utf8FromBuf","decode","randomBytes","size","getRandomValues","Secret","constructor","fromLatin1","fromUTF8","fromBase32","fromHex","latin1","enumerable","utf8","base32","timingSafeEqual","a","b","out","g","HOTP","defaults","issuer","label","counter","secret","generate","_ref","offset","byteLength","otp","__pow","validate","_ref2","token","delta","generatedToken","_ref3","e","encodeURIComponent","TOTP","period","timestamp","Date","now","Math","floor","OTPURI_REGEX","SECRET_REGEX","ALGORITHM_REGEX","INTEGER_REGEX","POSITIVE_INTEGER_REGEX","URI","parse","uri","uriGroups","match","error","Array","isArray","URIError","uriType","toLowerCase","uriLabel","split","map","decodeURIComponent","uriParams","reduce","cur","pairArr","pairKey","pairVal","pairAcc","OTP","config","test","stringify","version"],"mappings":"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"}